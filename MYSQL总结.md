## MYSQL总结

#### 1. 索引

+ 索引可以加快数据库的检索速度。
+ 索引会降低插入、删除、修改的速度。



1. 索引的基础知识

   - Mysql的基本存储结构是**页**，记录都存在页里面。

   - 数据页之间是双向链表，页中的记录是单向链表。

   - 页除了用于存储数据，还作为页目录来索引其他数据页。在没有页目录的情况下，一条没有走索引的sql语句默认会如下做：

     - 遍历数据页间的双向链表，定位数据所在的页；

     - 在相应区间段的数据页中，如果不是根据主键查询，则遍历页中的单向链表。

       综上，没有优化的sql语句执行查找效率会很低。

   - 索引的作用，简单说是将无序的数据变成有序；底层结构有两种：B+树索引和哈希索引。

     1. ##### B+树索引

        - 为数据页创建页目录，自身也是页结构。
        - B+树是平衡树的一种，从根节点到所有叶子结点的路径长度之差不会超过1，并且所有叶子结点之间用指针连接，即形成链表。
        - 建立索引会为对应的列根据情况创建对应的B+树。对表进行增删改操作，就要维持B+树的平衡，这种维护索引带来的额外开销会影响增删改的效率。

     2. ##### 哈希索引

        采用哈希算法，把键值换算成哈希值，根据哈希值定位数据。但是哈希算法也有缺点：

        + 不能排序；
        + 不支持最左匹配原则；
        + 哈希碰撞：在有大量重复键值的情况下，哈希索引效率会很低；
        + 不支持范围查询。
        + **InnoDB是否支持哈希索引：**mysql官方文档表明InnoDB只支持B+树索引，但其实InnoDB也支持哈希索引，并且InnoDB的哈希索引是自适应的，引擎会根据情况自动为表创建哈希索引，不能人为干预。

     3. ##### 聚集索引和非聚集索引

        - 聚集索引就是以**主键**创建的索引，在叶子结点上存储的是**表中的数据**
        - 非聚集索引（二级索引）就是以**非主键**创建的索引， 在叶子结点上存储的是**主键和索引列**
        - 使用非聚集索引查询数据，要拿到叶子上的主键再去查找，这个动作叫**回表**。
        - 非聚集索引可以用多个列来创建索引。具体哪个列走索引，哪个列不走，就是最左匹配原则。
        - 创建多个单列索引的时候，会生成多个索引树占用磁盘空间。
        - **覆盖索引**：查询出的列和索引是对应的，不用再拿主键回表查询其他列，而是可以直接返回。

     4. ##### 索引最左匹配原则

        - 对于多列索引，索引命中的规则是查询条件是否包含建立索引时最左边列，也就是说，对于（a，b，c）三个列建成的索引，可以命中索引的列条件组合有（a）、（a，b）、（a，b，c）三种。
        - MySQL会根据语句的查询条件一直向右匹配，直到遇到范围查询。

     5. ##### 建立索引注意的点

        - 最左前缀匹配原则
        - 尽量选择区分度高的列作为索引（？）
        - 索引列不能参与计算，保持列干净
        - 尽可能扩展已有的索引，不要新建立过多索引。MySQL同时只会用一个最严格的索引。



#### 2. 锁

- 